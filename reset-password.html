<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reset Your FortuneSpin Password</title>
  <link rel="stylesheet" href="style/user.css" />
</head>
<body class="login-body">
  <div class="login-container glass-card">
    <h2>Reset Password</h2>
    <p id="info-msg">Please enter your new password below.</p>
    <input type="password" id="new-password" placeholder="New Password" />
    <input type="password" id="confirm-password" placeholder="Confirm Password" />
    <button id="reset-btn">Reset Password</button>
    <p id="error-msg" class="error"></p>
    <p id="success-msg" style="color: limegreen;"></p>
  </div>

  <script type="module">
    import { auth } from './js/firebase.js';
    import { confirmPasswordReset } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    // Extract oobCode from URL query string
    const params = new URLSearchParams(window.location.search);
    const oobCode = params.get('oobCode');

    const resetBtn = document.getElementById('reset-btn');
    const errorMsg = document.getElementById('error-msg');
    const successMsg = document.getElementById('success-msg');

    resetBtn.onclick = async () => {
      errorMsg.textContent = '';
      successMsg.textContent = '';

      const newPassword = document.getElementById('new-password').value.trim();
      const confirmPassword = document.getElementById('confirm-password').value.trim();

      if (newPassword.length < 6) {
        errorMsg.textContent = "Password must be at least 6 characters long.";
        return;
      }
      if (newPassword !== confirmPassword) {
        errorMsg.textContent = "Passwords do not match.";
        return;
      }
      if (!oobCode) {
        errorMsg.textContent = "Invalid or missing reset code.";
        return;
      }

      try {
        await confirmPasswordReset(auth, oobCode, newPassword);
        successMsg.textContent = "Your password has been reset successfully! Redirecting to login...";
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 3000);
      } catch (error) {
        errorMsg.textContent = "Error resetting password: " + error.message;
      }
    };
  </script>
</body>
</html>
