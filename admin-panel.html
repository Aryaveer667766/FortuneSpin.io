<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🛰️ FortuneSpin God Mode HQ</title>
  <link rel="stylesheet" href="style/admin.css">
  <link rel="icon" href="assets/logo/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Rajdhani:wght@500&display=swap" rel="stylesheet">
  <style>
    /* Add minimal styles here for the table */
    #users-list-panel {
      margin-top: 2rem;
    }
    #users-list-panel input[type="text"] {
      width: 300px;
      padding: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    #users-table {
      width: 100%;
      border-collapse: collapse;
      color: #eee;
    }
    #users-table th, #users-table td {
      border: 1px solid #444;
      padding: 0.6rem 1rem;
      text-align: left;
    }
    #users-table th {
      background: #222;
    }
    .lock-icon, .unlock-icon {
      cursor: pointer;
      font-size: 1.3rem;
      user-select: none;
    }
    .lock-icon {
      color: #dc3545; /* red */
    }
    .unlock-icon {
      color: #28a745; /* green */
    }
  </style>
</head>
<body class="admin-body">

  <!-- 🔻 HEADER -->
  <header>
    <img src="assets/logo/logo.png" class="admin-logo" />
    <h1>FORTUNESPIN | ADMIN HQ</h1>
    <p class="live-indicator">🟢 SYSTEM ONLINE</p>
  </header>

  <!-- ⚙️ CONTROL PANEL -->
  <main>
    <section class="panel" id="user-panel">
      <h2>👤 User Control</h2>
      <input type="text" placeholder="Search UID or username..." id="search-user" />
      <button onclick="searchUser()">Search</button>
      <div id="user-result">No user selected.</div>
    </section>

    <section class="panel">
      <h2>🎡 Spin Control</h2>
      <input type="text" id="spin-uid" placeholder="UID" />
      <input type="number" id="spin-count" placeholder="Spins to Add" />
      <input type="number" id="win-amount" placeholder="Set Win ₹ Amount (Optional)" />
      <button onclick="assignSpin()">Assign Spin</button>
    </section>

    <section class="panel">
      <h2>💸 Withdrawals</h2>
      <button onclick="loadWithdrawals()">🔁 Refresh Requests</button>
      <div id="withdraw-list">No pending requests.</div>
    </section>

    <section class="panel">
      <h2>🧾 Tickets</h2>
      <button onclick="loadTickets()">🔁 Refresh Tickets</button>
      <div id="ticket-list">No tickets loaded.</div>
    </section>

    <section class="panel">
      <h2>🧑‍🤝‍🧑 Referral Tree</h2>
      <input type="text" id="ref-uid" placeholder="Enter UID" />
      <button onclick="viewReferralTree()">View Tree</button>
      <div id="ref-tree"></div>
    </section>

    <!-- NEW Users List Panel -->
    <section class="panel" id="users-list-panel">
      <h2>👥 Users List</h2>
      <input type="text" id="users-search" placeholder="Search by Name, Email, Phone, UID..." oninput="filterUsers()" />
      <table id="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>UID</th>
            <th>Phone</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="users-tbody">
          <!-- User rows will be injected here -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- 🔊 SOUNDS -->
  <audio id="click-sound" src="assets/sounds/click.mp3" preload="auto"></audio>
  <audio id="alert-sound" src="assets/sounds/alert.mp3" preload="auto"></audio>
  <audio id="confetti-sound" src="assets/sounds/confetti.mp3" preload="auto"></audio>

  <!-- 🎯 JS -->
  <script type="module" src="js/admin.js"></script>
  <script>
    // Sound Effects
    const click = document.getElementById("click-sound");
    document.querySelectorAll("button").forEach(btn =>
      btn.addEventListener("click", () => click.play())
    );

    // Sample function to toggle user lock status - you will implement the real logic in admin.js
    async function toggleLock(uid, currentStatus, row) {
      // Play click sound
      click.play();

      // Here you would update the Firebase DB with new status for the user
      // For demo, just toggle UI and status text

      const newStatus = currentStatus === 'Unlocked' ? 'Locked' : 'Unlocked';
      const statusCell = row.querySelector(".status-cell");
      const iconCell = row.querySelector(".lock-toggle-icon");

      // Update UI
      statusCell.innerText = newStatus;
      if (newStatus === 'Locked') {
        iconCell.innerHTML = '<span class="lock-icon" title="Unlock User">🔒</span>';
      } else {
        iconCell.innerHTML = '<span class="unlock-icon" title="Lock User">🔓</span>';
      }

      // TODO: Update Firebase here...

      alert(`User ${uid} is now ${newStatus}`);
    }

    // Filter users table based on search input
    function filterUsers() {
      const filter = document.getElementById('users-search').value.toLowerCase();
      const rows = document.querySelectorAll('#users-tbody tr');
      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        if (text.includes(filter)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // Function to render users in table - call this from admin.js after fetching users
    export function renderUsers(users) {
      // users = array of user objects: { uid, name, phone, unlocked }
      const tbody = document.getElementById('users-tbody');
      tbody.innerHTML = '';
      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.name || '—'}</td>
          <td>${user.uid}</td>
          <td>${user.phone || '—'}</td>
          <td class="status-cell">${user.unlocked ? 'Unlocked' : 'Locked'}</td>
          <td class="lock-toggle-icon" style="cursor:pointer;">
            ${user.unlocked ? 
              '<span class="unlock-icon" title="Lock User">🔓</span>' : 
              '<span class="lock-icon" title="Unlock User">🔒</span>'
            }
          </td>
        `;

        // Add click event on lock/unlock icon cell
        tr.querySelector(".lock-toggle-icon").addEventListener('click', () => {
          toggleLock(user.uid, user.unlocked ? 'Unlocked' : 'Locked', tr);
        });

        tbody.appendChild(tr);
      });
    }
  </script>

</body>
</html>
