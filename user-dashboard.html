<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fortune Realm</title>
  <link rel="stylesheet" href="style/user.css" />
  <link rel="stylesheet" href="style/spin.css" />
  <link rel="icon" href="assets/logo/logo2.png" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Poppins&display=swap" rel="stylesheet">
  <style>
    canvas { display:block; margin:auto; }
  </style>
</head>
<body>

  <!-- ğŸ”± Header -->
  <header class="dashboard-header">
    <img src="assets/logo/logo.png" />
    <h1>FortuneSpin Dashboard</h1>
    <p>Your UID: <span id="user-uid">Loading...</span></p>
  </header>

  <main>

    <!-- ğŸ”’ LOCKED SCREEN -->
    <div id="locked-msg" style="display: none;">
      <p>ğŸ”’ Your Lucky Draw is Locked</p>
      <p>Send your UID on WhatsApp to unlock spins.</p>
      <button onclick="openWhatsApp()" class="unlockBtn">ğŸ“± Unlock Your Spins NOW ! CLICK HERE !</button>
    </div>

    <!-- ğŸ¡ SPIN WHEEL -->
    <section id="spin-section" style="display: none; text-align:center;">
      <h2>ğŸ¯ Try Your Luck!</h2>
      
      <div style="position: relative; display: inline-block;">
        <!-- Pointer Arrow -->
        <div style="
          position: absolute;
          top: -15px;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 15px solid transparent;
          border-right: 15px solid transparent;
          border-bottom: 25px solid red;
          z-index: 10;
        "></div>

        <!-- Canvas Wheel -->
        <canvas id="wheelCanvas" width="270" height="270" style="border-radius: 50%; background: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.3);"></canvas>
      </div>

      <br><br>
      <button id="spin-btn" style="
        background: linear-gradient(45deg, #ff9800, #ff5722);
        border: none;
        padding: 12px 30px;
        font-size: 18px;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      ">SPIN</button>
      <p id="spin-result" style="margin-top: 15px; font-weight: bold; color: gold;">Tap SPIN to win!</p>
    </section>

    <!-- ğŸ’° BALANCE PANEL -->
    <section class="balance-section">
      <h3>ğŸ’° Your Balance</h3>
      â‚¹<span id="user-balance">0</span>
    </section>

    <!-- ğŸ§‘â€ğŸ¤â€ğŸ§‘ REFERRAL -->
    <section>
      <h3>ğŸ‘« Invite & Earn â‚¹99</h3>
      <input type="text" id="referral-link" readonly />
      <button onclick="copyReferral()">Copy Referral Link</button>
    </section>

    <!-- ğŸ’¸ WITHDRAW -->
    <section>
      <h3>ğŸ’¸ Withdraw Winnings</h3>
      <a href="withdraw.html">
        <button type="button">Request Withdrawal</button>
      </a>
      <p id="withdraw-msg" style="color: gold;"></p>
    </section>

    <!-- ğŸ§¾ SUPPORT TICKET -->
    <section>
      <h3>ğŸ†˜ Support Ticket</h3>
      <input type="text" id="ticket-subject" placeholder="Subject" />
      <textarea id="ticket-message" placeholder="Describe your issue..." rows="3"></textarea>
      <button onclick="submitTicket()">Submit Ticket</button>
    </section>

    <!-- Refill Spins Section -->
    <div id="refill-section" style="display:none; position: fixed; bottom: 20px; right: 20px; background: #222; color: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 9999;">
      <p style="margin: 0 0 10px;">You have 0 spins left!</p>
      <button id="refill-btn" style="padding: 10px 15px; background: green; color: white; border: none; border-radius: 5px; cursor: pointer;">Refill Spins</button>
      <button id="close-refill" style="margin-left: 10px; padding: 10px 15px; background: red; color: white; border: none; border-radius: 5px; cursor: pointer;">I will refill later</button>
    </div>

    <!-- ğŸ“¢ NOTIFICATIONS -->
    <section class="notification-section">
      <h3>ğŸ“¢ Notifications</h3>
      <div id="notifications">No messages yet.</div>
    </section>

    <!-- ğŸ† WINNER FEED -->
    <section>
      <h3>ğŸ† Live Winners</h3>
      <marquee behavior="scroll" direction="left" scrollamount="5" style="color: #FFD700; font-weight:bold;" id="winner-feed">
        ğŸ‰ X83KTR won â‚¹10,000 â€¢ ğŸ‰ M22BDX won â‚¹5,000 â€¢ ğŸ‰ A77ZZQ won â‚¹25,000 â€¢ ğŸ‰ L94HTU won â‚¹2,000 â€¢ ğŸ‰ F18JOP won â‚¹15,000 â€¢ ğŸ‰ T73YLM won â‚¹3,000 â€¢
        ğŸ‰ W62QAZ won â‚¹12,000 â€¢ ğŸ‰ D55VBN won â‚¹8,500 â€¢ ğŸ‰ K12ZXC won â‚¹9,000 â€¢ ğŸ‰ H77WER won â‚¹7,000 â€¢ ğŸ‰ G99NBV won â‚¹11,000 â€¢ ğŸ‰ P34MKO won â‚¹6,500 â€¢
      </marquee>
    </section>
  </main>

  <!-- ğŸ‰ Confetti Canvas -->
  <canvas id="confetti-canvas"></canvas>

  <!-- ğŸ”Š Sound Effects -->
  <audio id="spin-sound" src="assets/spin.mp3"></audio>
  <audio id="win-sound" src="assets/win.mp3"></audio>
  <audio id="error-sound" src="assets/sounds/error.mp3"></audio>

  <!-- âœ… Wheel Logic -->
  <script>
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spin-btn");
    const resultText = document.getElementById("spin-result");

    const segments = ["Try Again", "Small Prize", "Jackpot", "Bonus Spin", "Better Luck", "Big Prize"];
    const colors = ["#FF5733","#33FF57","#3357FF","#FF33A6","#FFC300","#00CED1"];
    let startAngle = 0;
    let spinAngle = 0;
    let spinning = false;

    function drawWheel() {
      const arc = Math.PI * 2 / segments.length;
      for (let i = 0; i < segments.length; i++) {
        const angle = startAngle + i * arc;
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.moveTo(200, 200);
        ctx.arc(200, 200, 200, angle, angle + arc);
        ctx.fill();
        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate(angle + arc / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "white";
        ctx.font = "16px Montserrat";
        ctx.fillText(segments[i], 180, 5);
        ctx.restore();
      }
    }

    function spinWheel() {
      if (spinning) return;
      spinning = true;
      resultText.textContent = "Spinning...";
      spinAngle = Math.random() * 1000 + 2000; // total spin angle
      const duration = 4000; // spin time
      const startTime = performance.now();

      function animate(time) {
        const elapsed = time - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3); // smooth slow-down
        startAngle += (spinAngle * (1 - easeOut)) / 100;
        drawWheel();
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          determineResult();
        }
      }
      requestAnimationFrame(animate);
    }

    function determineResult() {
      const arc = Math.PI * 2 / segments.length;
      const degrees = startAngle * 180 / Math.PI + 90;
      const normalized = (degrees % 360 + 360) % 360;
      const index = Math.floor((360 - normalized) / (360 / segments.length)) % segments.length;
      resultText.textContent = `ğŸ‰ You got: ${segments[index]}!`;
    }

    drawWheel();
    spinBtn.addEventListener("click", spinWheel);
  </script>

  <script>
    function openWhatsApp() {
      let uid = document.getElementById("user-uid").textContent.trim();
      if (uid.startsWith("UID#")) {
        uid = uid.slice(4);
      }
      const message = `Hi, my UID is ${uid}. Please unlock my FortuneSpin account.`;
      const url = `https://wa.me/6283194274244?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    }

    function copyReferral() {
      const link = document.getElementById("referral-link");
      if (navigator.clipboard) {
        navigator.clipboard.writeText(link.value).then(() => {
          alert("Referral link copied!");
        }).catch(() => {
          fallbackCopyText(link);
        });
      } else {
        fallbackCopyText(link);
      }
    }

    function fallbackCopyText(element) {
      element.select();
      try {
        document.execCommand("copy");
        alert("Referral link copied!");
      } catch (err) {
        alert("Failed to copy. Please copy manually.");
      }
    }
  </script>

</body>
</html>
